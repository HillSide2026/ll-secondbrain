schema_version: 0.1
id: system_admin_sweep
name: System Admin Sweep
description: Orchestrate system admin SAA agents into a unified sweep with a shared output contract.
run_root: 06_RUNS/${run_id}/system_admin
output_contract:
  markdown: 00_SYSTEM/AGENTS/specs/system_admin/SAA_OUTPUT_CONTRACT.md
  schema: 00_SYSTEM/AGENTS/specs/system_admin/SAA_OUTPUT_CONTRACT.json
steps:
  - id: repo_linter
    action: run_agent
    agent: SAA_REPO_LINTER
    inputs:
      - path: 00_SYSTEM/AGENTS/specs/system_admin/SAA_OUTPUT_CONTRACT.md
      - path: 00_SYSTEM/AGENTS/specs/system_admin/_shared/inventory.schema.json
      - path: 00_SYSTEM/AGENTS/specs/system_admin/_shared/findings.schema.json
    outputs:
      - path: ${run_root}/inventory.json
      - path: ${run_root}/findings_SAA_REPO_LINTER.json
      - path: ${run_root}/appendix_repo_linter.md
    failure_mode:
      on_blocker_findings: mark_run_failed_continue
  - id: folder_map_drift
    action: run_agent
    agent: SAA_FOLDER_MAP_DRIFT
    inputs:
      - path: ${run_root}/inventory.json
      - path: 00_SYSTEM/AGENTS/specs/system_admin/SAA_OUTPUT_CONTRACT.md
      - path: 00_SYSTEM/AGENTS/specs/system_admin/_shared/findings.schema.json
    outputs:
      - path: ${run_root}/findings_SAA_FOLDER_MAP_DRIFT.json
      - path: ${run_root}/appendix_folder_map_drift.md
    failure_mode:
      on_blocker_findings: mark_run_failed_continue
  - id: metadata_enforcer
    action: run_agent
    agent: SAA_METADATA_ENFORCER
    inputs:
      - path: ${run_root}/inventory.json
      - path: 00_SYSTEM/AGENTS/specs/system_admin/SAA_OUTPUT_CONTRACT.md
      - path: 00_SYSTEM/AGENTS/specs/system_admin/_shared/findings.schema.json
      - path: 00_SYSTEM/AGENTS/specs/system_admin/_shared/metadata_index.schema.json
    outputs:
      - path: ${run_root}/findings_SAA_METADATA_ENFORCER.json
      - path: ${run_root}/appendix_metadata_enforcer.md
    failure_mode:
      on_blocker_findings: mark_run_failed_continue
  - id: reference_integrity
    action: run_agent
    agent: SAA_REFERENCE_INTEGRITY
    inputs:
      - path: ${run_root}/inventory.json
      - path: 00_SYSTEM/AGENTS/specs/system_admin/SAA_OUTPUT_CONTRACT.md
      - path: 00_SYSTEM/AGENTS/specs/system_admin/_shared/findings.schema.json
    outputs:
      - path: ${run_root}/findings_SAA_REFERENCE_INTEGRITY.json
      - path: ${run_root}/appendix_reference_integrity.md
    failure_mode:
      on_blocker_findings: mark_run_failed_continue
  - id: registry_sync
    action: run_agent
    agent: SAA_REGISTRY_SYNC
    inputs:
      - path: ${run_root}/inventory.json
      - path: 02_PLAYBOOKS/_registry/PLAYBOOK_INDEX.md
      - path: 00_SYSTEM/AGENTS/specs/system_admin/SAA_OUTPUT_CONTRACT.md
      - path: 00_SYSTEM/AGENTS/specs/system_admin/_shared/findings.schema.json
    outputs:
      - path: ${run_root}/findings_SAA_REGISTRY_SYNC.json
      - path: ${run_root}/appendix_registry_sync.md
    failure_mode:
      on_blocker_findings: mark_run_failed_continue
  - id: merge_findings
    action: merge_findings
    inputs:
      - path: ${run_root}/findings_SAA_REPO_LINTER.json
      - path: ${run_root}/findings_SAA_FOLDER_MAP_DRIFT.json
      - path: ${run_root}/findings_SAA_METADATA_ENFORCER.json
      - path: ${run_root}/findings_SAA_REFERENCE_INTEGRITY.json
      - path: ${run_root}/findings_SAA_REGISTRY_SYNC.json
      - path: 00_SYSTEM/AGENTS/specs/system_admin/SAA_OUTPUT_CONTRACT.md
    outputs:
      - path: ${run_root}/findings.json
    failure_mode:
      on_blocker_findings: mark_run_failed_continue
  - id: render_reports
    action: render_reports
    inputs:
      - path: ${run_root}/findings.json
      - path: ${run_root}/inventory.json
      - path: 00_SYSTEM/AGENTS/specs/system_admin/SAA_OUTPUT_CONTRACT.md
    outputs:
      - path: ${run_root}/findings.md
      - path: ${run_root}/SYSTEM_ADMIN_REPORT.md
    failure_mode:
      on_blocker_findings: mark_run_failed_continue
run_logging:
  runlog: ${run_root}/runlog.md
  provenance: ${run_root}/provenance.json
